<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="${title}"></title>
<script th:src="@{/js/jquery-3.6.1.min.js}"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script>
	
	$(function(){
		fn_fileCheck();
		fn_removeAttach();
	});
		
	function fn_fileCheck(){
		
		$('#files').change(function(){
			
			// 첨부 가능한 파일의 최대 크기
			let maxSize = 1024 * 1024 * 10;  // 10MB
			
			// 첨부된 파일 목록
			let files = this.files;
			
			// 첨부된 파일 순회
			$('#file_list').empty();
			$.each(files, function(i, file){
				
				// 크기 체크
				if(file.size > maxSize){
					alert('10MB 이하의 파일만 첨부할 수 있습니다.');
					$(this).val('');  // 첨부된 파일을 모두 없애줌
					return;
				}
				
				// 첨부 목록 표시
				$('#file_list').append('<div>' + file.name + '</div>');
				
			});
			
		});
		
	}
	
	function fn_removeAttach(){
		// 첨부 삭제
		$('.lnk_remove_attach').click(function(event){
			if(confirm('첨부 파일을 삭제할까요?') == false){
				event.preventDefault();
				return;
			}
		});
	}
	
</script>
</head>
<body>

	<div>
	
		<h1>수정화면</h1>
		
		<form th action="@{/upload/modify}" method="post" enctype="multipart/form-data">
		
		
			<div>
				<label for="title">제목</label>
				<input type="text" id="title" name="title" th:value="${upload.title}" required="required">
			</div>
			<div>
				<label for="content">내용</label>
				<input type="text" id="content" name="content" th:value="${upload.content}">
			</div>
			<div>
				<label for="files">첨부 추가</label>
				<input type="file" id="files" name="files" multiple="multiple">
				<div id="file_list"></div>
			</div>
		
			<div>
				<button>수정완료</button>
				<input type="button" value="목록" onclick="location.href='/upload/list'">
			</div>

			<input type="hidden" name="uploadNo" th:value="${upload.uploadNo}">
		
		</form>
		
		<div>
			<h3>첨부삭제</h3>	
			<div th:each="attach : ${attachList}">
				<div>
					${attach.origin}<a class="lnk_remove_attach" href="/upload/attach/remove?uploadNo=${upload.uploadNo}&attachNo=${attach.attachNo}"><i class="fa-regular fa-trash-can"></i></a>
				</div>
			
		</div>
	
	</div>
	
</body>
</html>