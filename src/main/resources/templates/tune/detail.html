<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header::head('Tag Music')}"></head>
<meta charset="UTF-8">
<title>Tag Music > 상세보기</title>
<link rel="stylesheet" th:href="@{/css/tuneDetail.css}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
<script>
	$(function(){
		fn_tabContent();
		fn_next_track_box();
		fn_lyrics_box();
		fn_icon();
	});

	function fn_tabContent(){
		$('.tune_tab_content').click(function(){
			$('.tune_tab_content').removeClass('border_bottom_solid_white');
			$('.tune_next_track_box').addClass('blind');
			$('.tune_lyrics_box').addClass('blind');
			$(this).addClass('border_bottom_solid_white');
		});
	}
	
	function fn_next_track_box(){
		$('.tab_next_track').click(function(){
			$('.tune_next_track_box').removeClass('blind');
		});
	}
	
	function fn_lyrics_box(){
		$('.tab_lyrics').click(function(){
			$('.tune_lyrics_box').removeClass('blind');
		});
	}
	
	function fn_click_album_image(){
		$('#albumImg').click(function(){
			var imgSrc =  $(this).attr('src').val();
			$('#music_iframe').attr('src', imgSrc);
		});
	}
	
	var i = 0;	// 플레이 중인지 아닌지 확인하는 변슈
	function fn_icon() {
		$('.tune_main_panel').on('click', function(){
			if(i==0) {
				$('i').attr('class', 'bi bi-pause-circle-fill');
				$('i').css('animation-play-state','running');
				i++;
				location.href='/tune/iframe?musicNo=26';
			} else {
				$('i').attr('class', 'bi bi-play-circle-fill');
				$('i').css('animation-play-state','running');
				i--;
			}
		});
	}

</script>
<style>

</style>
</head>
<body>
	<div th:replace="~{layout/header.html::header_layout}"></div>
	<div th:replace="~{layout/side.html::side_layout}"></div>
	
	<div class="tune_container">
		<div class="tune_content">
			<div class="tune_main_panel">
				<div class="flex_center blind">
					<i class="bi bi-play-circle-fill"></i>
				</div>
				<div class="flex_center">
				</div>
				<img th:src="@{/tune/display/image(musicNo=${music.musicNo})}" name="image" class="tune_album_img">
			</div>
			<div class="tune_side_panel">
				<div class="tune_tab">
					<div class="tune_tab_content tab_next_track border_bottom_solid_white">
						다음 트랙
					</div>
					<div class="tune_tab_content tab_lyrics">
						가사
					</div>
					<div class="tune_tab_content">
						댓글
					</div>
				</div>
				<div class="tune_next_track_box">
					다음 트랙
					1
					2
					3
					4
					...
				</div>
				<div class="tune_lyrics_box blind">
					<textarea class="tune_lyrics" th:text="${music.musicContent}"></textarea>
				</div>
				
				<!-- 댓글 -->
				<div class="comment_box">
					<div>
						<form id="frm_comment">
							<div>
								<input type="text" name="email" th:value="${session.loginUser.email}">
								<input type="text" name="musicNo" th:value="${music.musicNo}">	
								<input type="text" name="commentContent" id="commentContent" placeholder="댓글을 작성하려면 로그인 해 주세요.">
								<input type="button" value="작성완료" id="btn_add_comment">
							</div>
						</form>
					</div>
					<div id="comment_list"></div>
					<div id="paging"></div>
				</div>
				
				<!-- 음원 다운로드 -->
				<div class="blind">
					<a th:href="@{/tune/download(musicNo=${music.musicNo})}">음원 다운로드 하기</a>
				</div>
			</div>
		</div>
		
		<script>
			$(function(){
				// 댓글
				fn_addComment();
			});
			
			function fn_addComment(){
			$('#btn_add_comment').click(function(){
				if($('#commentContent').val() == ''){
					alert('댓글 내용을 입력하세요');
					return;
				}
				$.ajax({
					type: 'post',
					url: '/comment/add',
					data: $('#frm_comment').serialize(),
					dataType: 'json',
					success: function(resData){  // resData = {"isAdd", true}
						if(resData.isAdd){
							alert('댓글이 등록되었습니다.');
							$('#commentContent').val('');
							fn_commentList();   // 댓글 목록 가져와서 뿌리는 함수
							fn_commentCount();  // 댓글 목록 개수 갱신하는 함수
						}
					}
				});
			});
		}
		</script>
		
	</div>
</body>
</html>