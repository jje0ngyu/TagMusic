<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header::head('Tag Music')}"></head>
<meta charset="UTF-8">
<title>Tag Music > 상세보기</title>
<link rel="stylesheet" th:href="@{/css/tune/detail.css}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">

<script th:src="@{/js/jquery-3.6.1.min.js}"></script>
<script th:src="@{/js/tune/detail.js}"></script>

</head>
<body>
	<div th:replace="~{layout/header.html::header_layout}"></div>
	<div th:replace="~{layout/side.html::side_layout}"></div>
	
	<div class="tune_container">
		<div class="tune_content">
			<div class="tune_main_panel">
				<img th:src="@{/tune/display/image(musicNo=${music.musicNo})}" name="image" class="tune_album_img">
			</div>
			<div class="tune_side_panel">
				<div class="tune_tab">
					<div class="tune_tab_content tab_next_track border_bottom_solid_white">
						다음 트랙
					</div>
					<div class="tune_tab_content tab_lyrics">
						가사
					</div>
					<div class="tune_tab_content tab_comment">
						댓글
					</div>
				</div>
				<div class="tune_next_track_box">
					<script>
						$.ajax({
							type: 'get',
							url : '/tune/track',
							dataType: 'json',
							success : function(resData) {
								var txt = '';
								if(resData.musicList != 0) {
									$.each(resData.musicList, function(i, music){
										txt += '<div>' + music.musicNo+ '</div>';
										txt += '<div>' + music.musicTitle + '</div>';
										txt += '<div>' + music.email + '</div>';
									});
									
									$('.tune_next_track_box').append(txt);
								}
							},
							error : function() {
								console.log('에러');
							}
						});
						
					</script>
				</div>
				<div class="tune_lyrics_box blind">
					<textarea class="tune_lyrics" th:text="${music.musicContent}"></textarea>
				</div>
				
				<!-- 댓글 -->
				<div class="tune_comment_box blind">
					<span id="btn_comment_list">
						댓글
						<span id="comment_count"></span>개
					</span>
					<div>
						<form id="frm_comment">
							<div>
								<input th:if="${session.loginUser != null}" type="hidden" name="email" id="email" th:value="${session.loginUser.email}">
								<input type="hidden" name="musicNo" th:value="${music.musicNo}">	
								<input type="text" name="commentContent" id="commentContent" placeholder="댓글을 작성하려면 로그인 해 주세요.">
								<input type="button" value="작성완료" id="btn_add_comment">
							</div>
						</form>
					</div>
					<div id="comment_list"></div>
					<div id="paging"></div>
					<!--/* 현재 페이지 번호를 저장하고 있는 hidden */-->
					<input type="hidden" id="page" value="1">
				</div>
				
				
				<!-- 음원 다운로드 -->
				<div class="blind">
					<a th:href="@{/tune/download(musicNo=${music.musicNo})}">음원 다운로드 하기</a>
				</div>
			</div>
		</div>
			
	</div>
</body>
</html>