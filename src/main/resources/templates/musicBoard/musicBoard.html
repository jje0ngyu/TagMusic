<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header::head('Tag Music')}"></head>
<meta charset="UTF-8">
<title></title>
<!-- static 폴더 이후의 위치를 적으면 된다. -->
<script th:src="@{/js/jquery-3.6.1.min.js}"></script>


<script th:inline="javascript">

	$(function() {
	
		fn_modal();
		

	});
	
    function fn_modal() {	// 플레이리스트 목록창
    	
    		$('.modal_open_btn').click(function() {
    			
    			$('#modal').css('display', 'block');
    			
    			$.ajax({
    				type: 'get',
    				url: '/music/user/playlist',
    				dataType: 'json',
    				success: function(resData) {
    					

    					// 플레이리스트 목록
    					$('.playlist_items').empty();	// 상단 리스트 최신화
   						
    				
    					
    					var body = $('<tbody class="modal_body">');
    					
    					$.each(resData.userPlaylist, function(index, playlist) {
    						
    						$('<tr class="modal_tr">')
    							.append('<td class="modal_td">1</td>')
    							.append( $('<td class="modal_td">').append('<div class="playlistName">'+playlist.listName+'</div>') )
    							.append( $('<td class="modal_td">').append('<div class="select_playlist" data-listno="'+playlist.listNo+'">선택</div>') )
    							.appendTo($(body) );
    						
    					});
    					
    					
    					$('.playlist_items')
    					.append( $('<table class="modal_table">')
						.append('<thead class="modal_table_head"><tr class="modal_tr"><td>No</td><td class="modal_td">플레이리스트명</td><td class="modal_td">선택</td></tr></thead>')
						.append($(body)) ) ;
    						
    					}
    					});
    				});
    					
    	
			$('.modal_close_btn').click(function() {
    			
    			$('#modal').css('display', 'none');	
    		});

    }
    		
    		


</script>
</head>
<body>

	<!--  page : 최신리스트 게시판 -->
	
	<div th:replace="~{layout/header.html::header_layout}"></div>

	<div class="session">
		<div th:replace="~{layout/side.html::side_layout}"></div>
		
			<div class="list_container">
				<div class="list_page">
				
					<div class="page_title">
					<!-- 구현 : 요청마다 게시판 이름 변경하기  -->
						<p th:text="${pageName}"></p>
					</div>
				
					<div class="list_page_header">
					<!--  구현 : 장르별 조회하기 -->
						<div class="select_genre">
							<div class="select_genre_title">장르별 선택하기</div>
							<ul class="list_select_ul">
								<li class="list_select_li">전체</li>
								<li class="list_select_li">발라드</li>
								<li class="list_select_li">팝송</li>
								<li class="list_select_li">ost</li>
								<li class="list_select_li">트로트</li>
								<li class="list_select_li">기타</li>
								<li class="list_select_li">기타</li>
							</ul>
						</div>
					</div>
					<div class="select_all_btn_area">
						<input type="button" value="전체선택" class="btn_all">	
					</div>
					<div class="list_page_table">
						<table>
							<thead>
								<tr>
									<td><div class="td">선택</div></td>
									<td><div class="td">No</div></td>
									<td colspan="3"><div class="td_music">곡정보</div></td>
									
									
									<td><div class="td">좋아요</div></td>
									<td><div class="td">
									리스트에 담기</div></td>
									<td><div class="td">다운로드</div></td>
								</tr>
						</thead>
						<tbody>
							<tr th:each="music,vs:${musicList}">
								<td>
									<input type="checkbox">
								</td>
								<td class="td_no" th:text="${beginNo -vs.index}"></td>
								<!-- # 구현 : 썸네일 가져오기 -->
								<!-- 방법 : 타임리프 if else(unless)를 통해 해결  -->
								<td>
									<span th:if="${music.hasThumbNail == 1}" >
										<img class="board_thumbnail" th:src="@{/music/thumbnail(musicNo=${music.musicNo})}">
									</span>
									<span th:unless="${music.hasThumbNail == 1}" >
										<img class="board_thumbnail" th:src="@{/images/defaultImage.png}">
									</span>
								<td>
									
									<div th:text="${music.musicTitle}" class="title_artist"></div>
									<div th:text="${music.activeLogDTO.userDTO.artist}" class="title_artist"></div>	<!-- * 조인된 테이블에서 데이터 꺼내는 법  -->
								</td>
								
								<td>
									<div th:text="${music.musicGenre}"></div>
								</td>
								<td>
									<input type="button" value="좋아요">
								</td>
								<td class="board_playlist_area">
									<div class="playlist_hidden">
										
										<!-- # 구현 : 모달창 -->
										
										
										<div id="root">   
										    <button type="button" class="modal_open_btn">플레이리스트에 담기</button>
										</div>
										
										
										<div id="modal">
   
										    <div class="modal_content">
										        <h2>플레이리스트를 선택하세요</h2>
										        	<div class="playlist_items">
										        	
										        		<table class="modal_table">
										        			<thead class="modal_table_head">
										        				<tr class="modal_tr">
										        					<td class="modal_td">no</td>
										        					<td class="modal_td" >플레이리스트명</td>
										        					<td class="modal_td">선택</td>
										        				</tr>
										        			</thead>
										        			<tbody  class="modal_body">
										        				<tr class="modal_tr">
										        					<td class="modal_td">1</td>
										        					<td class="modal_td">
										        						<div class="playlistName"></div>
										        					</td>
										        					<td class="modal_td">
										        						<div class="select_playlist"></div>
										        					</td>
										        				</tr>
										        			</tbody>
										        		</table>
										        		<!-- <iframe src="/music/playlistModal" align bottom class="" scrolling="no"></iframe>  -->

										        	</div>
										        
										     
										        <button type="button" class="modal_close_btn">창 닫기</button>
										    </div>
										    <div class="modal_layer"></div>
										</div>
										
										<style>
										
									
											  .modal_table {
											    width: 400px;
											    border-top: 1px solid #444444;
											    border-collapse: collapse;
											  }
											  .modal_td, .modal_tr {
											    border-bottom: 1px solid #444444;
											    padding: 10px;
											  }

											#modal {
											  position:fixed;
											  top:250px;
											  left: 0;
											  width:100%;
											  height:100%;
											  z-index:1;
											  display: none;
											}

											#modal h2 {
											  margin:0;   
											}
											
											#modal button {
											  display:inline-block;
											  width:100px;
											  margin-left:calc(100% - 100px - 10px);
											}
											
											#modal .modal_content {
											  width:450px;
											  margin:50px auto;
											  padding:20px 10px;
											  background:#fff;
											  border:2px solid #666;
											}
											
											#modal .modal_layer {
											  position:fixed;
											  top:0;
											  left:0;
											  width:100%;
											  height:100%;
											  background:rgba(0, 0, 0, 0.8);
											  z-index:-1;
											}   
											</style>
									
									</div>
									
									
								</td>
								<td>
									<input type="button" id="modal_close" value="다운받기">
								</td>
							</tr>
						</tbody>
					</table>
					
					<!-- 구현 : 게시글 업로드 -->
					<div class="btn_area">
						<input type="button" value="삭제" class="upload_btn">
						<div>
							<input type="button" value="업로드" class="delete_btn">
							<input type="button" value="전부다운받기" class="delete_btn">
						</div>
					</div>
					
					<!-- 구현 : 게시글 페이징 처리 + 검색기능 -->
					<div class="list_page_footer">
						<div class="page_block" th:utext="${paging}" ></div>
						<div class="list_page_search">
							<input type="text" placeholder="검색" class="list_page_search_text">
							<input type="button" value="검색" class="list_page_search_btn">
						</div>
					</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>