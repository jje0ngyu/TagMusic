<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header::head('Tag Music')}"></head>
<meta charset="UTF-8">
<title></title>
<style>
	ul,ol{list-style:none}
	a{text-decoration:none;color:#fff962;font-size:15px}
	nav{overflow:hidden;height:80px;background-color:#1b2035; margin-top:150px;}
	#nav3 {
	  width: 80%;
	  height: 10%;
	  position: relative;
	  text-align: center;
	}
	#nav3>a {
	  line-height: 80px;
	  display: block;
	  font-size: 30px;
	  font-weight: 900;
	  position: absolute;
	  left: 30px;
	}
	#nav3>select {
	  padding: 0 20px;
	  height: 30px;
	  background-color: #1b2035;
	  color: #fff;
	  position: absolute;
	  right: 30px;
	  top: 50%;
	  transform: translateY(-15px);
	  border: 2px solid #fff;
	  border-radius: 30px;
	}
	#nav3>ul {
	  display: inline-block;
	}
	#nav3>ul li {
	  float: left;
	  line-height: 80px;
	  padding: 0 30px;
	}
	#buyPageDiv{
		width: 80%;
		
	}
	
</style>
<!-- static 폴더 이후의 위치를 적으면 된다. -->
<script th:src="@{/js/jquery-3.6.1.min.js}"></script>
<script type="text/javascript" src="https://service.iamport.kr/js/iamport.payment-1.1.5.js"></script>
<script type="text/javascript">

$(document).ready(function(){
	fn_passList();
 });
function fn_passList(){
	console.log('하이');
	$.ajax({
		type: 'post',
		url: '/pass/list',
		dataType: 'json',
		success: function(resData){
			var txt = '';
			$.each(resData.passList, function(i, pass){
				txt += '<h2>'+pass.passName+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+pass.passPrice+' 원!</h2>';
				txt += '<input type="button" value="카카오페이로 결제하기" data-ticket="TagMusic-'+pass.passName+'" data-pg="kakaopay" data-amount="'+pass.passPrice+'" onclick="fn_buyTicket(this)">';
				if(pass.passName == "30일이용권"){
					txt += '<input type="button" value="선물하기" id="btn_gift">';
				}
				txt += '<br>';
				txt += '<br>';
				txt += '<br>';
			});
			$('#buyPageDiv').append(txt);
		}
	});
}
function fn_buyTicket(e){
		
		var musicAmount = $(e).data('amount');
		var paymentPg = $(e).data('pg');
		var ticketName = $(e).data('ticket');
		console.log(ticketName);
			
		var IMP = window.IMP; // 생략가능
		IMP.init('imp66111374');
		var merchant_uid = 'TagMusic_' + new Date().getTime();
		IMP.request_pay({ 
			pg: paymentPg,
		pay_method: 'card',
		merchant_uid: merchant_uid,
		name: ticketName, 
		//name: '노래제목:'+firstCartMusicName+' 외'+ (muprice-1) +'곡',
		amount: musicAmount,
		buyer_email: 'iamport@siot.do',// 구매자
		buyer_name: '홍길동',
		buyer_tel: '010-1234-5678',
		buyer_addr: '서울특별시 강남구 삼성동',
		buyer_postcode: '123-456',
		m_redirect_url: 'https://www.yourdomain.com/payments/complete'
	}, 
	function (rsp) {
		console.log(rsp);
		if (rsp.success) {
			$.ajax({
				type: 'post',
				url: '/payment/thirtyDay',
				data: ''
			});
			var msg = '결제가 완료되었습니다.';
			msg += '고유ID : ' + rsp.imp_uid;
			msg += '상점 거래ID : ' + rsp.merchant_uid;
			msg += '결제 금액 : ' + rsp.paid_amount;
			msg += '카드 승인번호 : ' + rsp.apply_num;
		} else {
			var msg = '';
			msg += rsp.error_msg;
		}
			alert(msg);
		});
	
}



</script>
</head>
<body>
	
	<div th:replace="~{layout/header.html::header_layout}"></div>

	<div class="session">
		<div th:replace="~{layout/side.html::side_layout}"></div>
		
		
		<!--  ** 모든 컨텐츠는 해당 content태그 아래에서 작성하시오  ** -->
		<div class="content">
			<nav id="nav3">
				<h1>이용권 구매</h1>
				<hr>
				<ul>
					<li>
						<a th:href="@{/payment/buy}">태그뮤직 BEST</a>
					</li>
				</ul>
			</nav>
			<div id="buyPageDiv">
			</div>
		</div>
	</div>

	
</body>
</html>